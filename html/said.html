<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0 ,user-scalable=no">
    <title>七大歧记</title>
    <link rel="preload" href="https://chinese-fonts-cdn.deno.dev/packages/jhlst/dist/%E4%BA%AC%E8%8F%AF%E8%80%81%E5%AE%8B%E4%BD%93v2_002/result.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <!--<link rel="stylesheet" href="https://chinese-fonts-cdn.deno.dev/packages/jhlst/dist/%E4%BA%AC%E8%8F%AF%E8%80%81%E5%AE%8B%E4%BD%93v2_002/result.css" media="print" onload="this.media='all'; this.onload=null;">-->
    <noscript>
        <link rel="stylesheet" href="https://chinese-fonts-cdn.deno.dev/packages/jhlst/dist/%E4%BA%AC%E8%8F%AF%E8%80%81%E5%AE%8B%E4%BD%93v2_002/result.css">
    </noscript>
    <meta name="description" content="七大歧记 - 七大直播挑战CCBC16纪实">
    <link rel="shortcut icon" href="./favicon.ico" type="image/x-icon">
    <style>
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #ffffff;
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #000;
        }
        
        body * {
            font-family:'KingHwa_OldSong';
            font-weight:'400';
            transition: all ease .3s;
        }

        #items-container {
            width: 100%;
            height: 100%;
            overflow: hidden;
            position: relative;
        }

        #items-list {
            list-style: none;
            padding: 0;
            margin: 0;
            padding-top: 50px;
            padding-bottom: 50px;
        }

        #items-list li {
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            transition: all 0.5s cubic-bezier(0.25, 0.1, 0.25, 1);
            opacity: 0.5;
            transform: scale(0.95);
            color: #bbb;
            white-space: normal;
            word-wrap: break-word;
            padding: 15px 20px;
            box-sizing: border-box;
            flex-direction: column;

        }
        
        #items-list li .embd-list, #items-list li .embd-li {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        #items-list li.active {
            opacity: 1;
            transform: scale(1);
            color: #666;
            font-weight: bold;
        }

        .embd-list {
            margin: 10px 0;
            padding: 5px 10px;
            text-align: left; 
            width: 100%;
        }

        p.embd-li {
            margin: 5px 0;
            font-size: 1.5em;
            color: #000;
        }

        #items-list li img {
            max-height: 50px;
            vertical-align: middle;
            margin: 0 5px;
        }

        #items-list li video {
            max-height: 50px;
            vertical-align: middle;
            margin: 0 5px;
        }

        /* 切换按钮样式 */

        .load-anim {
            font-size: 10px;
            margin: auto auto;
            text-indent: -9999em;
            width: 1rem !important;
            height: 1rem !important;
            border-radius: 50%;
            background: #F1C40F;
            background: linear-gradient(to right, #F1C40F 10%, rgba(255, 255, 255, 0) 42%);
            position: relative;
            animation: loadanim 1.4s infinite linear;
            -webkit-transform: translateZ(0);
            -ms-transform: translateZ(0);
            transform: translateZ(0);
        }
        .load-anim:before {
            width: 50%;
            height: 50%;
            background: #F1C40F;
            border-radius: 100% 0 0 0;
            position: absolute;
            top: 0;
            left: 0;
            content: '';
        }
        .load-anim:after {
            background: #D35400;
            width: 75%;
            height: 75%;
            border-radius: 50%;
            content: '';
            margin: auto;
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
        }
        @-webkit-keyframes loadanim {
        0% {
            -webkit-transform: rotate(0deg);
            transform: rotate(0deg);
        }
        100% {
            -webkit-transform: rotate(360deg);
            transform: rotate(360deg);
        }
        }
        @keyframes loadanim {
        0% {
            -webkit-transform: rotate(0deg);
            transform: rotate(0deg);
        }
        100% {
            -webkit-transform: rotate(360deg);
            transform: rotate(360deg);
        }
        }
        #toggle-button {
            display: flex;
            position: fixed;
            top: 2rem;
            right: 2rem;
            padding: .5rem 1rem;
            height: 2.5rem;
            background-color: #D35400;
            color: white;
            border: none;
            border-radius: 1.25rem;
            cursor: pointer;
            font-size: 1rem;
            z-index: 100;
            align-items: center;
            justify-content: center;
        }
        /*
        #toggle-button:hover {
            background-color: #45a049;
        }
        */
        .auto-man {
            display: inline;
        }

        .auto-auto, .load-anim {
            display: none;
        }

        #toggle-button.auto .auto-auto, #toggle-button.auto .load-anim {
            display: inline-block !important;
        }

        #toggle-button.auto .auto-man{
            display: none !important;
        }

        #toggle-button:hover {
            color: #F1C40F;
        }

        #reset-button {
            display: flex;
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            padding: .5rem 1rem;
            height: 2.5rem;
            background-color: #FF4343;
            color: white;
            border: none;
            border-radius: 1.25rem;
            cursor: pointer;
            font-size: 1rem;
            z-index: 100;
            align-items: center;
            justify-content: center;
        }

        #reset-button:hover {
            background-color: #F57C00;
        }
    </style>
</head>
<body>
    <button id="toggle-button" class="auto"><div class="load-anim"></div><span class="auto-man">手动</span><span class="auto-auto">自动</span></button>
    <button id="reset-button">回到开头</button>
    <div id="items-container">
        <ul id="items-list"></ul>
    </div>

    <script>
        const itemsString = `${__node_markdown_content__}`;

        function transformNestedUlLi(htmlString) {
          const parser = new DOMParser();
          const doc = parser.parseFromString(htmlString, 'text/html');

          function processNode(node) {
            if (!node.children) return;

            const children = [...node.children];

            for (const child of children) {
              if (child.tagName === 'UL' || child.tagName === 'OL') {
                if (child.parentNode && child.parentNode.tagName === 'LI') {
                  //console.log('Replacing nested UL/OL inside LI:', child.outerHTML);
                  const div = doc.createElement('div');
                  div.className = 'embd-list';
                  // 复制属性
                  // for (const attr of child.attributes) {
                  //   div.setAttribute(attr.name, attr.value);
                  // }
                  while (child.firstChild) {
                    div.appendChild(child.firstChild);
                  }
                  child.parentNode.replaceChild(div, child);
                  processNode(div);
                } else {
                  processNode(child);
                }
              } else if (child.tagName === 'LI') {
                if (child.parentNode && (child.parentNode.tagName === 'DIV' && child.parentNode.classList.contains('embd-list'))) {
                  //console.log('Replacing nested LI inside DIV:', child.outerHTML);
                  const p = doc.createElement('p');
                  p.className = 'embd-li';
                  while (child.firstChild) {
                    p.appendChild(child.firstChild);
                  }
                  child.parentNode.replaceChild(p, child);
                  processNode(p);
                } else {
                  processNode(child);
                }
              } else {
                processNode(child);
              }
            }
          }

          processNode(doc.body);
          return doc.body;
        }


        const transformedBody = transformNestedUlLi(itemsString);
        const processedUl = transformedBody.querySelector('ul');
        
        const itemsList = document.getElementById('items-list');
        if (processedUl) {
            while (processedUl.firstChild) {
                itemsList.appendChild(processedUl.firstChild);
            }
        }

        const itemsItems = document.querySelectorAll('#items-list li');
        const container = document.getElementById('items-container');
        const toggleButton = document.getElementById('toggle-button');
        const resetButton = document.getElementById('reset-button');
        
        let currentIndex = 0;
        let isAutoScroll = true;
        let autoScrollInterval;

        // 给列表项添加点击事件，允许用户点击某一行歌词直接跳转
        itemsItems.forEach((item, index) => {
            item.addEventListener('click', () => {
                stopAutoScroll();
                currentIndex = index;
                updateActiveItem();
            });
        });

        function updateActiveItem() {
            itemsItems.forEach((item, index) => {
                if (index === currentIndex) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
            try {
                if (currentIndex !== 0) {
                    document.getElementById('reset-button').style.display = 'flex';
                }else {
                    document.getElementById('reset-button').style.display = 'none';
                }
            } catch (e) {
                console.error('reset btn error:', e);
            }
            if (itemsItems[currentIndex]) {
                const containerRect = container.getBoundingClientRect();
                const activeItemRect = itemsItems[currentIndex].getBoundingClientRect();
                
                const scrollAmount = activeItemRect.top - containerRect.top + container.scrollTop - (containerRect.height / 2) + (activeItemRect.height / 2);
                
                container.scrollTo({
                    top: scrollAmount,
                    behavior: 'smooth'
                });
            }
        }

        function stopAutoScroll() {
            if (autoScrollInterval) {
                clearInterval(autoScrollInterval);
                autoScrollInterval = null;
            }
            if (isAutoScroll) {
                isAutoScroll = false;
                toggleButton.classList.remove('auto');
            }
        }

        function startAutoScroll() {
            stopAutoScroll();
            
            isAutoScroll = true;
            toggleButton.classList.add('auto');
            
            autoScrollInterval = setInterval(() => {
                if (currentIndex < itemsItems.length - 1) {
                    currentIndex++;
                    updateActiveItem();
                } else {
                    stopAutoScroll();
                }
            }, 3000);
        }

        function toggleScrollMode() {
            console.log('Toggle button clicked. Current mode:', isAutoScroll ? 'Auto' : 'Manual');
            
            if (!isAutoScroll) {
                if (currentIndex < itemsItems.length - 1) {
                    startAutoScroll();
                }
            } else {
                stopAutoScroll();
            }
        }

        function resetToStart() {
            stopAutoScroll();
            currentIndex = 0;
            updateActiveItem();
        }

        let touchStartY = 0;
        let touchEndY = 0;
        let isScrolling = false;
        const touchThreshold = 15;
        const sensitivity = 0.3;

        function handleTouchStart(event) {
            stopAutoScroll();
            touchStartY = event.touches[0].clientY;
            touchEndY = touchStartY;
            isScrolling = false;
        }

        function handleTouchMove(event) {
            touchEndY = event.touches[0].clientY;
            const deltaY = touchStartY - touchEndY;
            
            if (Math.abs(deltaY) > touchThreshold) {
                isScrolling = true;
            }
            if (isScrolling) {
                event.preventDefault();
            }
        }

        function handleTouchEnd() {
            if (!isScrolling) return;
            
            const deltaY = touchStartY - touchEndY;
            const absDeltaY = Math.abs(deltaY);
            
            let rowsToScroll = 1;
            

            if (absDeltaY > 325) {
                rowsToScroll = 5; 
            } else if (absDeltaY > 250) {
                rowsToScroll = 4; 
            } else if (absDeltaY > 175) {
                rowsToScroll = 3; 
            } else if (absDeltaY > 100) {
                rowsToScroll = 2; 
            }

            let newIndex = currentIndex;
            if (deltaY > 0) {
                newIndex = Math.min(currentIndex + rowsToScroll, itemsItems.length - 1);
            } else {
                newIndex = Math.max(currentIndex - rowsToScroll, 0);
            }
            
            if (newIndex !== currentIndex) {
                currentIndex = newIndex;
                updateActiveItem();
            }
        }

        function handleManualScroll(event) {
            stopAutoScroll();
            event.preventDefault();
            
            const delta = event.deltaY;
            let rowsToScroll = 1;
            
            if (Math.abs(delta) > 150) {
                rowsToScroll = 3;
            } else if (Math.abs(delta) > 100) {
                rowsToScroll = 2;
            }
            
            if (delta > 0 && currentIndex < itemsItems.length - 1) {
                currentIndex = Math.min(currentIndex + rowsToScroll, itemsItems.length - 1);
                updateActiveItem();
            } else if (delta < 0 && currentIndex > 0) {
                currentIndex = Math.max(currentIndex - rowsToScroll, 0);
                updateActiveItem();
            }
        }

        toggleButton.addEventListener('click', toggleScrollMode);
        container.addEventListener('wheel', handleManualScroll, { passive: false });
        container.addEventListener('touchstart', handleTouchStart, { passive: false });
        container.addEventListener('touchmove', handleTouchMove, { passive: false });
        container.addEventListener('touchend', handleTouchEnd);
        resetButton.addEventListener('click', resetToStart);

        resetToStart();
        setTimeout(startAutoScroll, 1000);
    </script>
</body>
</html>



